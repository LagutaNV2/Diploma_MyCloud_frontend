"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[732],{732:function(e,t,a){a.r(t),a.d(t,{default:function(){return f},useAppSelector:function(){return E}});var l=a(540),r=a(468),n=a(794),s=a(394),m=a(27),c=a(392);const o=e=>new Date(e).toLocaleString();var i=({file:e})=>{const[t,a]=(0,l.useState)(!1),[r,n]=(0,l.useState)(!1),[i,d]=(0,l.useState)(e.original_name),[u,b]=(0,l.useState)(!1),[f,E]=(0,l.useState)(e.comment),[x,g]=(0,l.useState)(null),p=(0,s.j)();return l.createElement("tr",{className:"hover:bg-blue-50 transition-colors duration-150"},l.createElement("td",null,r?l.createElement("div",{className:"flex items-center justify-between"},l.createElement("input",{type:"text",value:i,onChange:e=>d(e.target.value),className:"border rounded p-1 mr-2 flex-grow"}),l.createElement("div",{className:"flex items-center space-x-2"},l.createElement("button",{onClick:async()=>{if(""!==i.trim())try{await p((0,c.Io)({fileId:e.id,updatedData:{original_name:i}})).unwrap(),n(!1)}catch(e){alert("Ошибка при переименовании файла")}else alert("Имя файла не может быть пустым")},className:"bg-green-500 text-white px-2 py-1 rounded flex items-center"},l.createElement(m.CMH,{className:"mr-1"})),l.createElement("button",{onClick:()=>n(!1),className:"bg-gray-300 text-gray-700 px-2 py-1 rounded flex items-center"},l.createElement(m.QCr,{className:"mr-1"})))):l.createElement("div",{className:"flex items-center justify-between"},l.createElement("div",null,e.original_name),l.createElement("button",{onClick:()=>n(!0),className:"ml-auto text-blue-500 hover:text-blue-700"},l.createElement(m.uO9,null)))),l.createElement("td",null,u?l.createElement("div",{className:"flex items-center justify-between"},l.createElement("textarea",{value:f,onChange:e=>E(e.target.value),className:"border rounded p-1 mr-2 flex-grow"}),l.createElement("div",{className:"flex items-center space-x-2"},l.createElement("button",{onClick:async()=>{try{await p((0,c.Io)({fileId:e.id,updatedData:{comment:f}})).unwrap(),b(!1)}catch(e){alert("Ошибка при обновлении комментария")}},className:"bg-green-500 text-white px-2 py-1 rounded flex items-center"},l.createElement(m.CMH,{className:"mr-1"})),l.createElement("button",{onClick:()=>b(!1),className:"bg-gray-300 text-gray-700 px-2 py-1 rounded flex items-center"},l.createElement(m.QCr,{className:"mr-1"})))):l.createElement("div",{className:"flex items-center justify-between"},l.createElement("div",null,e.comment||"Нет комментария"),l.createElement("button",{onClick:()=>b(!0),className:"ml-auto text-blue-500 hover:text-blue-700"},l.createElement(m.uO9,null)))),l.createElement("td",null,((e,t=2)=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(t))+" "+["Bytes","KB","MB","GB"][a]})(e.size)),l.createElement("td",{className:"whitespace-nowrap"},o(e.upload_date)),l.createElement("td",{className:"whitespace-nowrap"},e.last_download?o(e.last_download):"еще не скачивался"),l.createElement("td",null,l.createElement("div",{className:"flex items-center justify-between"},l.createElement("div",{className:"text-blue-600 break-all mr-2 truncate max-w-xs"},e.public_link.toString().slice(0,20),"..."),l.createElement("button",{onClick:()=>{const t=`${window.location.origin}/api/storage/public/${e.public_link}/`;navigator.clipboard.writeText(t),a(!0),setTimeout(()=>a(!1),2e3)},className:"text-blue-500 hover:text-blue-700 ml-auto",title:"Скопировать публичную ссылку"},t?l.createElement(m.CMH,{className:"text-green-500"}):l.createElement(m.paH,null)))),l.createElement("td",{className:"actions-column"},l.createElement("div",{className:"flex flex-col space-y-2"},l.createElement("button",{onClick:()=>{p((0,c.PE)({fileId:e.id,fileName:e.original_name}))},className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm"},"Скачать"),l.createElement("button",{onClick:async()=>{try{const t=await p((0,c.RO)({fileId:e.id})).unwrap();g(t),window.open(t,"_blank")}catch(e){alert("Ошибка при попытке просмотреть файл")}},className:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm"},"Просмотреть"),l.createElement("button",{onClick:()=>{window.confirm("Вы уверены, что хотите удалить файл?")&&p((0,c.Ww)(e.id))},className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors"},"Удалить"))))};var d=()=>{const{files:e,loading:t,error:a}=(0,s.G)(e=>e.files);return t?l.createElement("div",null,"Загрузка файлов..."):a?l.createElement("div",{className:"text-red-500"},"Ошибка: ",a):l.createElement("div",{className:"overflow-x-auto rounded-lg border border-gray-200 shadow-sm"},l.createElement("table",{className:"min-w-full"},l.createElement("thead",null,l.createElement("tr",{className:"bg-gray-50"},l.createElement("th",{className:"font-medium"},"Имя файла"),l.createElement("th",{className:"font-medium"},"Комментарий"),l.createElement("th",{className:"font-medium"},"Размер"),l.createElement("th",{className:"font-medium"},"Дата загрузки"),l.createElement("th",{className:"font-medium"},"Последнее скачивание"),l.createElement("th",{className:"font-medium"},"Публичная ссылка"),l.createElement("th",{className:"font-medium"},"Действия"))),l.createElement("tbody",null,0===e.length?l.createElement("tr",null,l.createElement("td",{colSpan:7,className:"py-6 text-center text-gray-500"},"Нет загруженных файлов")):e.map(e=>l.createElement(i,{key:e.id,file:e})))))};var u=()=>{const[e,t]=(0,l.useState)(null),[a,r]=(0,l.useState)(""),[n,m]=(0,l.useState)(0),[o,i]=(0,l.useState)(""),d=(0,s.j)();return l.createElement("div",{className:"border rounded-lg p-4 bg-gray-50"},o&&l.createElement("div",{className:"text-red-500 mb-4"},o),l.createElement("form",{onSubmit:async l=>{if(l.preventDefault(),!e)return void i("Выберите файл для загрузки");const n=new FormData;n.append("file",e),a&&n.append("comment",a);try{await d((0,c.QM)({formData:n,onUploadProgress:e=>{const t=Math.round(100*e.loaded/(e.total||1));m(t)}})).unwrap(),t(null),r(""),m(0),i("")}catch(e){i(e.message||"Ошибка загрузки файла")}},className:"space-y-4"},l.createElement("div",null,l.createElement("label",{className:"block mb-2 font-medium"},"Выберите файл"),l.createElement("input",{type:"file",onChange:e=>{e.target.files&&e.target.files[0]&&t(e.target.files[0])},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})),l.createElement("div",null,l.createElement("label",{className:"block mb-2 font-medium"},"Комментарий (необязательно)"),l.createElement("textarea",{value:a,onChange:e=>r(e.target.value),className:"w-full p-2 border border-gray-300 rounded",rows:2})),e&&l.createElement("div",null,l.createElement("p",null,"Размер файла: ",(e.size/1024/1024).toFixed(2)," MB")),n>0&&l.createElement("div",{className:"w-full bg-gray-200 rounded-full"},l.createElement("div",{className:"bg-blue-500 text-xs font-medium text-blue-100 text-center p-0.5 leading-none rounded-full",style:{width:`${n}%`}},n,"%")),l.createElement("button",{type:"submit",disabled:!e||n>0,className:"px-4 py-2 rounded "+(!e||n>0?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white")},"Загрузить")))},b=a(857);var f=()=>{const{user:e}=E(e=>e.auth),[t,a]=(0,l.useState)(null),r=(0,n.zy)(),m=new URLSearchParams(r.search).get("user"),o=(0,s.j)(),{error:i}=E(e=>e.files),f=!m||e&&e.id===m;return console.log("Current user:",e,"Selected user ID:",m,"Is current user:",f),(0,l.useEffect)(()=>{(async()=>{if(m)try{const e=await b.A.get(`/auth/users/${m}/`);a(e.data),console.log("Selected user:",e.data)}catch(e){console.error("Failed to fetch user:",e)}o((0,c.Uq)(m?parseInt(m):void 0))})()},[o,m]),(0,l.useEffect)(()=>{(async()=>{try{await o((0,c.Uq)(m?parseInt(m):void 0))}catch(e){console.error("Failed to load files:",e)}})()},[o,m]),l.createElement("div",{className:"max-w-6xl mx-auto py-6"},l.createElement("h1",{className:"text-2xl font-bold mb-6"},f?"Мое хранилище":"Хранилище пользователя"),m&&t&&l.createElement("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-5 mb-6 shadow-sm"},l.createElement("div",{className:"flex items-start space-x-4"},l.createElement("div",{className:"flex-shrink-0"},l.createElement("div",{className:"bg-gray-200 border-2 border-dashed rounded-xl w-16 h-16 flex items-center justify-center"},l.createElement("span",{className:"text-gray-500 text-2xl"},t.first_name?.[0]||t.username?.[0]))),l.createElement("div",null,l.createElement("h2",{className:"text-xl font-semibold text-gray-800"},t.last_name," ",t.first_name,l.createElement("span",{className:"ml-2 text-gray-600 text-base font-normal"},"(@",t.username,")")),l.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-2"},l.createElement("div",{className:"flex items-center"},l.createElement("span",{className:"font-medium mr-2"},"Email:"),l.createElement("span",{className:"text-gray-700"},t.email)),l.createElement("div",{className:"flex items-center"},l.createElement("span",{className:"font-medium mr-2"},"Статус:"),l.createElement("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium "+(t.is_admin?"bg-yellow-100 text-yellow-800 border border-yellow-200":"bg-blue-100 text-blue-800 border border-blue-200")},t.is_admin?" Администратор":" Пользователь")),l.createElement("div",{className:"flex items-center"},l.createElement("span",{className:"font-medium mr-2"},"Использовано:"),l.createElement("span",{className:"text-gray-700 font-medium"},t.formatted_total_file_size)))))),l.createElement("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden"},i&&l.createElement("div",{className:"bg-red-50 border-b border-red-200 text-red-700 px-6 py-4"},l.createElement("div",{className:"flex items-center"},l.createElement("svg",{className:"h-5 w-5 text-red-400 mr-3",fill:"currentColor",viewBox:"0 0 20 20"},l.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})),l.createElement("span",null,"Ошибка загрузки файлов: ",i))),f&&l.createElement("div",{className:"p-6 border-b border-gray-100"},l.createElement("h2",{className:"text-lg font-semibold text-gray-800 mb-3"},"Загрузка нового файла"),l.createElement(u,null)),l.createElement("div",{className:"p-6"},l.createElement("div",{className:"flex justify-between items-center mb-4"},l.createElement("h2",{className:"text-lg font-semibold text-gray-800"},f?"Мои файлы":"Файлы пользователя")),l.createElement(d,null))))};const E=r.d4}}]);