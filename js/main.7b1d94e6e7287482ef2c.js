"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[792],{75:function(e,t,a){a.d(t,{TK:function(){return s},hG:function(){return o},hU:function(){return l}});var r=a(360),n=a(857);const l=(0,r.zD)("users/fetch",async(e,t)=>{try{const e=await n.A.get("/auth/users/");return e.data.results||e.data}catch(e){return t.rejectWithValue(e.response?.data?.detail||"Ошибка загрузки пользователей")}}),s=(0,r.zD)("users/update",async({userId:e,userData:t},a)=>{try{return(await n.A.patch(`/auth/users/${e}/`,t)).data}catch(e){return a.rejectWithValue(e.response?.data?.detail||"Ошибка обновления пользователя")}}),o=(0,r.zD)("users/delete",async e=>(await n.A.delete(`/auth/users/${e}/`),e)),d=(0,r.Z0)({name:"users",initialState:{users:[],loading:!1,error:null},reducers:{},extraReducers:e=>{e.addCase(l.pending,e=>{e.loading=!0,e.error=null}).addCase(l.fulfilled,(e,t)=>{e.users=t.payload,e.loading=!1}).addCase(l.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Ошибка загрузки пользователей"}).addCase(s.fulfilled,(e,t)=>{const a=e.users.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.users[a]=t.payload)}).addCase(o.fulfilled,(e,t)=>{e.users=e.users.filter(e=>e.id!==t.payload)})}});t.Ay=d.reducer},249:function(e,t,a){var r=a(540),n=a(468),l=a(794),s=a(338),o=a(394),d=a(976);var c=()=>{const e=(0,o.j)(),{isAuthenticated:t,user:a}=(0,o.G)(e=>e.auth),n=(0,l.Zp)();return r.createElement("nav",{className:"bg-blue-600 text-white p-4 shadow-md"},r.createElement("div",{className:"container mx-auto flex justify-between items-center"},r.createElement(l.N_,{to:"/",className:"text-xl font-bold"},'Облачное хранилище "My Cloud"'),t&&a&&r.createElement("div",{className:"flex items-center space-x-4"},r.createElement("span",{className:"font-medium"},a.last_name," ",a.first_name," (",a.username,")"),a.is_admin&&r.createElement("span",{className:"bg-yellow-500 text-xs px-2 py-1 rounded"},"Admin")),r.createElement("div",{className:"nav-menu"},t?r.createElement(r.Fragment,null,a?.is_admin&&r.createElement(l.N_,{to:"/admin",className:"hover:underline"},"Админ-панель"),r.createElement(l.N_,{to:"/storage",className:"hover:underline"},"Мое хранилище"),r.createElement("button",{onClick:()=>{e((0,d.y4)()),n("/login")},className:"bg-red-500 hover:bg-red-600 px-3 py-1 rounded"},"Выход")):r.createElement(r.Fragment,null,r.createElement(l.N_,{to:"/login",className:"hover:underline mr-4"},"Вход"),r.createElement(l.N_,{to:"/register",className:"hover:underline"},"Регистрация")))))};var i=()=>r.createElement("div",{className:"flex flex-col min-h-screen"},r.createElement(c,null),r.createElement("main",{className:"flex-grow container mx-auto p-4"},r.createElement(l.sv,null)),r.createElement("footer",{className:"bg-gray-800 py-4 md:py-6 text-center"},"Дипломный проект по профессии «Fullstack-разработчик на Python, 2025»"));var u=({isAdmin:e=!1})=>{const{isAuthenticated:t,user:a}=(0,o.G)(e=>e.auth);return t?e&&!a?.is_admin?r.createElement(l.C5,{to:"/",replace:!0}):r.createElement(l.sv,null):r.createElement(l.C5,{to:"/login",replace:!0})};var m=()=>r.createElement("div",{className:"flex justify-center items-center h-64"},r.createElement("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"}));const f=r.lazy(()=>a.e(289).then(a.bind(a,289))),p=r.lazy(()=>a.e(115).then(a.bind(a,115))),h=r.lazy(()=>a.e(711).then(a.bind(a,711))),g=r.lazy(()=>Promise.all([a.e(997),a.e(673),a.e(489),a.e(680),a.e(732)]).then(a.bind(a,732))),y=r.lazy(()=>Promise.all([a.e(997),a.e(673),a.e(489),a.e(680),a.e(68)]).then(a.bind(a,68)));var E=()=>r.createElement(l.BV,null,r.createElement(l.qh,{path:"/",element:r.createElement(i,null)},r.createElement(l.qh,{index:!0,element:r.createElement(r.Suspense,{fallback:r.createElement(m,null)},r.createElement(f,null))}),r.createElement(l.qh,{path:"login",element:r.createElement(r.Suspense,{fallback:r.createElement(m,null)},r.createElement(p,null))}),r.createElement(l.qh,{path:"register",element:r.createElement(r.Suspense,{fallback:r.createElement(m,null)},r.createElement(h,null))}),r.createElement(l.qh,{element:r.createElement(u,null)},r.createElement(l.qh,{path:"storage",element:r.createElement(r.Suspense,{fallback:r.createElement(m,null)},r.createElement(g,null))})),r.createElement(l.qh,{element:r.createElement(u,{isAdmin:!0})},r.createElement(l.qh,{path:"admin",element:r.createElement(r.Suspense,{fallback:r.createElement(m,null)},r.createElement(y,null))})))),w=a(360),b=a(392),C=a(75);const A=(0,w.U1)({reducer:{auth:d.Ay,files:b.Ay,users:C.Ay}}),v=document.getElementById("root"),x=(0,s.createRoot)(v);x?x.render(r.createElement(n.Kq,{store:A},r.createElement(l.Kd,{basename:"/Diploma_MyCloud_frontend"},r.createElement(E,null)))):console.error("Root element not found! Check index.html")},392:function(e,t,a){a.d(t,{Io:function(){return c},PE:function(){return d},QM:function(){return s},RO:function(){return i},Uq:function(){return l},Ww:function(){return o}});var r=a(360),n=a(857);const l=(0,r.zD)("files/fetch",async e=>{const t=e?{user_id:e}:{};return(await n.A.get("/storage/files/",{params:t})).data}),s=(0,r.zD)("files/upload",async({formData:e,onUploadProgress:t})=>(await n.A.post("/storage/upload/",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:t})).data),o=(0,r.zD)("files/delete",async e=>(await n.A.delete(`/storage/files/${e}/`),e)),d=(0,r.zD)("files/download",async({fileId:e,fileName:t},a)=>{const r=await n.A.get(`/storage/files/${e}/download/`,{responseType:"blob"}),l=(new Date).toISOString();a.dispatch(f({fileId:e,lastDownload:l}));const s=window.URL.createObjectURL(new Blob([r.data])),o=document.createElement("a");return o.href=s,o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o),e}),c=(0,r.zD)("files/update",async({fileId:e,updatedData:t},a)=>{try{return(await n.A.patch(`/storage/files/${e}/update/`,t)).data}catch(e){return a.rejectWithValue(e.response?.data||"Ошибка обновления файла")}}),i=(0,r.zD)("files/preview",async({fileId:e})=>{const t=await n.A.get(`/storage/files/${e}/preview/`,{responseType:"blob"});return URL.createObjectURL(new Blob([t.data]))}),u=(0,r.Z0)({name:"files",initialState:{files:[],loading:!1,error:null,uploadProgress:0},reducers:{setUploadProgress(e,t){e.uploadProgress=t.payload},updateFileLastDownload:(e,t)=>{const{fileId:a,lastDownload:r}=t.payload,n=e.files.find(e=>e.id===a);n&&(n.last_download=r)}},extraReducers:e=>{e.addCase(l.pending,e=>{e.loading=!0,e.error=null}).addCase(l.fulfilled,(e,t)=>{e.files=t.payload,e.loading=!1}).addCase(l.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Ошибка загрузки файлов"}).addCase(s.pending,e=>{e.uploadProgress=0,e.error=null}).addCase(s.fulfilled,(e,t)=>{e.files.push(t.payload),e.uploadProgress=0}).addCase(s.rejected,(e,t)=>{e.uploadProgress=0,e.error=t.error.message||"Ошибка загрузки файла"}).addCase(o.fulfilled,(e,t)=>{e.files=e.files.filter(e=>e.id!==t.payload)}).addCase(c.fulfilled,(e,t)=>{const a=e.files.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.files[a]=t.payload)}).addCase(c.rejected,(e,t)=>{e.error=t.error.message||"Ошибка обновления файла"})}}),{setUploadProgress:m,updateFileLastDownload:f}=u.actions;t.Ay=u.reducer},394:function(e,t,a){a.d(t,{G:function(){return l},j:function(){return n}});var r=a(468);const n=()=>(0,r.wA)(),l=r.d4},857:function(e,t,a){a.d(t,{m:function(){return n}});const r=a(83).A.create({baseURL:"http://localhost:8000/api",withCredentials:!0});r.interceptors.response.use(e=>e,e=>(401===e.response?.status?(console.error("Unauthorized access - redirecting to login"),window.location.href="/login"):403===e.response?.status?console.error("Forbidden access - check permissions"):console.error("API error:",e.message),Promise.reject(e)));const n=async()=>{try{await r.get("/auth/csrf/")}catch(e){console.error("CSRF token fetch error:",e)}};r.interceptors.request.use(e=>{const t=document.cookie.split("; ").find(e=>e.startsWith("csrftoken="))?.split("=")[1];return t&&["post","put","patch","delete"].includes(e.method?.toLowerCase()||"")&&(e.headers=e.headers||{},e.headers["X-CSRFToken"]=t),e}),t.A=r},976:function(e,t,a){a.d(t,{DY:function(){return s},Lx:function(){return l},y4:function(){return o}});var r=a(360),n=a(857);(0,r.zD)("auth/csrf",async()=>{await n.A.get("/auth/csrf/")});const l=(0,r.zD)("auth/login",async(e,t)=>{console.log("start login....");try{await(0,n.m)();const t=await n.A.post("/auth/login/",e);if(console.log("login with response:",t),t.data&&t.data.id)return t.data;throw new Error("Invalid response structure")}catch(e){return 400===e.response?.status?t.rejectWithValue(e.response.data):t.rejectWithValue("Неверные учетные данные")}}),s=((0,r.zD)("auth/check",async()=>{try{return(await n.A.get("/auth/check_auth/")).data}catch(e){throw new Error("Not authenticated")}}),(0,r.zD)("auth/register",async(e,{rejectWithValue:t})=>{try{await(0,n.m)();return(await n.A.post("/auth/register/",e)).data}catch(e){return e.response?.data?t(e.response.data):t("Unknown registration error")}})),o=(0,r.zD)("auth/logout",async()=>{await n.A.post("/auth/logout/")}),d=(0,r.Z0)({name:"auth",initialState:{user:null,isAuthenticated:!1,loading:!1,error:null},reducers:{},extraReducers:e=>{e.addCase(l.pending,e=>{e.loading=!0,e.error=null}).addCase(l.fulfilled,(e,t)=>{e.user=t.payload.user||t.payload,e.isAuthenticated=!0,e.loading=!1}).addCase(l.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(s.pending,e=>{e.loading=!0,e.error=null}).addCase(s.fulfilled,(e,t)=>{e.user=t.payload.user,e.isAuthenticated=!0,e.loading=!1}).addCase(s.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(o.fulfilled,e=>{e.user=null,e.isAuthenticated=!1})}});t.Ay=d.reducer}},function(e){e.O(0,[285,980,997,673,489,680],function(){return t=249,e(e.s=t);var t});e.O()}]);