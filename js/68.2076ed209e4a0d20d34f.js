"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[68],{68:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var l=a(540),r=a(394),n=a(794),s=a(27),c=a(75);var m=({user:e})=>{const[t,a]=(0,l.useState)(e.is_admin),m=(0,r.j)();return l.createElement("tr",{className:"hover:bg-gray-50"},l.createElement("td",{className:"py-2 px-4 border-b"},e.username),l.createElement("td",{className:"py-2 px-4 border-b"},e.email),l.createElement("td",null,e.first_name),l.createElement("td",null,e.last_name),l.createElement("td",{className:"py-2 px-4 border-b"},l.createElement("input",{type:"checkbox",checked:t,onChange:async()=>{const l=!t;a(l);try{await m((0,c.TK)({userId:e.id,userData:{is_admin:l}})).unwrap()}catch(e){a(!l),alert("Ошибка обновления прав доступа")}},className:"h-5 w-5"})),l.createElement("td",{className:"py-2 px-4 border-b"},e.file_count),l.createElement("td",{className:"py-2 px-4 border-b"},e.formatted_total_file_size??0),l.createElement("td",{className:"actions-column"},l.createElement("div",{className:"relative"},l.createElement(n.N_,{to:`/storage?user=${e.id}`,className:"text-blue-600 hover:underline"},"Хранилище"),l.createElement("button",{onClick:()=>{e.is_admin?alert("Нельзя удалить администратора!"):window.confirm(`Удалить пользователя ${e.username}?`)&&m((0,c.hG)(e.id))},className:"absolute top-1/2 right-0 transform -translate-y-1/2 text-red-600 hover:text-red-800 delete-button",title:"Удалить пользователя"},l.createElement(s.QCr,{className:"text-lg"})))))};var o=()=>{const{users:e,loading:t,error:a}=(0,r.G)(e=>e.users);console.log("Users:",e);const n=((e,t=2)=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(t))+" "+["Bytes","KB","MB","GB"][a]})(e.reduce((e,t)=>e+(t.total_file_size||0),0));return t?l.createElement("div",null,"Загрузка пользователей..."):a?l.createElement("div",{className:"text-red-500"},"Ошибка: ",a):l.createElement("div",null,l.createElement("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg"},l.createElement("h2",{className:"text-lg font-semibold mb-2"},"Статистика системы"),l.createElement("p",null,"Всего пользователей: ",l.createElement("span",{className:"font-bold"},e.length)),l.createElement("p",null,"Общий объем хранилища: ",l.createElement("span",{className:"font-bold"},n))),l.createElement("div",{className:"overflow-x-auto"},l.createElement("table",{className:"min-w-full bg-white"},l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",{className:"py-2 px-4 border-b"},"Логин"),l.createElement("th",{className:"py-2 px-4 border-b"},"Email"),l.createElement("th",null,"Имя"),l.createElement("th",null,"Фамилия"),l.createElement("th",{className:"py-2 px-4 border-b"},"Администратор"),l.createElement("th",{className:"py-2 px-4 border-b"},"Файлов"),l.createElement("th",{className:"py-2 px-4 border-b"},"Объем"),l.createElement("th",{className:"py-2 px-4 border-b"},"Действия"))),l.createElement("tbody",null,e.map(e=>l.createElement(m,{key:e.id,user:e}))))))};var d=()=>{const e=(0,r.j)(),{user:t}=(0,r.G)(e=>e.auth);return(0,l.useEffect)(()=>{t?.is_admin&&e((0,c.hU)())},[e,t]),t?.is_admin?l.createElement("div",{className:"max-w-6xl mx-auto py-8"},l.createElement("h1",{className:"text-2xl font-bold mb-6"},"Администрирование (",t?.username,")"),l.createElement(o,null)):l.createElement("div",null,"Доступ запрещен")}}}]);